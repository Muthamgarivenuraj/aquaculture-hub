<!DOCTYPE html>
<html lang="te">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title data-i18n="title">Seeds ‚Ä¢ Aquaculture A‚ÄìZ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config={darkMode:'class',theme:{extend:{boxShadow:{soft:'0 12px 28px rgba(2,6,23,.08)'}}}}
  </script>
  <style>
    body{background:linear-gradient(135deg,#dbeafe 0,#e0f2fe 50%,#f0fdf4 100%)}
    .dark body{background:linear-gradient(135deg,#0f172a 0,#082f49 50%,#14532d 100%)}
    .field{border:1px solid rgb(226,232,240);border-radius:.5rem;padding:.5rem .6rem}
    .dark .field{background:#0b1220;border-color:#334155;color:#e2e8f0}
    .btn{padding:.6rem 1rem;border-radius:.75rem}
    .btn-primary{background:#059669;color:#fff}
    .btn-primary[disabled]{opacity:.5;cursor:not-allowed}
    .badge{font-size:.75rem;padding:.2rem .55rem;border-radius:.5rem}
  </style>
</head>
<body class="text-slate-900 dark:text-slate-100">
  <header class="sticky top-0 z-30 backdrop-blur bg-white/80 dark:bg-slate-950/70 border-b border-slate-200 dark:border-slate-800">
    <div class="max-w-5xl mx-auto px-4 py-3 flex items-center gap-3">
      <a href="index.html" class="rounded-lg px-3 py-1.5 border border-slate-200 dark:border-slate-800">‚Üê</a>
      <h1 class="text-lg font-bold flex-1" data-i18n="heading">Seed Booking</h1>
      <!-- Language + Theme -->
      <div class="hidden sm:flex rounded-full bg-slate-100 dark:bg-slate-900 p-1 border border-slate-200 dark:border-slate-800">
        <button id="langTE" class="px-3 py-1.5 text-sm rounded-full bg-white dark:bg-slate-800">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</button>
        <button id="langEN" class="px-3 py-1.5 text-sm rounded-full">English</button>
      </div>
      <button id="themeToggle" class="rounded-full px-3 py-1.5 text-sm border border-slate-200 dark:border-slate-800">üåô/‚òÄÔ∏è</button>
    </div>
  </header>

  <main class="max-w-5xl mx-auto p-4 space-y-6">

    <!-- Selectors -->
    <div class="rounded-2xl p-4 bg-white dark:bg-slate-900 shadow-soft border space-y-4">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
        <label class="text-sm" data-i18n="state">State
          <select id="sState" class="mt-1 field w-full"><option value="">Select</option></select>
        </label>
        <label class="text-sm" data-i18n="district">District
          <select id="sDistrict" class="mt-1 field w-full"><option value="">Select</option></select>
        </label>
        <label class="text-sm" data-i18n="village">Village
          <select id="sVillage" class="mt-1 field w-full"><option value="">Select</option></select>
        </label>
        <label class="text-sm" data-i18n="hatchery">Hatchery
          <select id="sHatchery" class="mt-1 field w-full"><option value="">Select</option></select>
        </label>
      </div>

      <!-- Hatchery Details -->
      <div id="hatchDetails" class="hidden p-4 rounded-xl border dark:border-slate-700 bg-slate-50 dark:bg-slate-800 space-y-2">
        <h2 id="hName" class="font-bold text-lg"></h2>
        <p id="hLoc" class="text-sm"></p>
        <div class="grid grid-cols-2 md:grid-cols-5 gap-2 text-sm">
          <div><span data-i18n="nextProd">Next Production</span> <div id="hProd" class="font-bold"></div></div>
          <div><span data-i18n="nextBatch">Next Batch</span> <div id="hBatch" class="font-bold"></div></div>
          <div><span data-i18n="salinity">Salinity</span> <div id="hSalinity" class="font-bold"></div></div>
          <div><span data-i18n="price">Price</span> <div id="hPrice" class="font-bold"></div></div>
          <div><span data-i18n="ehp">EHP Result</span> <div id="hEhp" class="font-bold"></div></div>
        </div>
        <span id="hBonus" class="badge bg-emerald-100 text-emerald-700"></span>
        <button id="bookBtn" class="btn btn-primary" data-i18n="book">Book</button>
      </div>
    </div>

    <!-- Booking Form -->
    <div id="bookingForm" class="hidden rounded-2xl p-4 bg-white dark:bg-slate-900 shadow-soft border space-y-4">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
        <label class="text-sm" data-i18n="date">Booking Date
          <input id="sDate" type="date" class="mt-1 field w-full">
        </label>
        <label class="text-sm" data-i18n="production">Production
          <input id="sBatch" type="text" class="mt-1 field w-full" readonly>
        </label>
        <label class="text-sm" data-i18n="qty">Quantity (pcs)
          <input id="sQty" type="number" value="0" class="mt-1 field w-full">
        </label>
        <label class="text-sm" data-i18n="price">Price
          <input id="sPrice" type="number" class="mt-1 field w-full" readonly>
        </label>
      </div>
      <p class="text-sm"><span data-i18n="bonus">Bonus</span>: <b id="sBonus">0%</b> | <span data-i18n="totalSeeds">Total Seeds</span>: <b id="sTotal">0</b> | <span data-i18n="amount">Amount</span>: <b id="sAmount">‚Çπ 0</b></p>

      <!-- Customer Details -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
        <label class="text-sm" data-i18n="mobile">Customer Mobile *
          <div class="mt-1 flex gap-2">
            <input id="custMobile" type="tel" placeholder="9xxxxxxxxx" class="field w-full" maxlength="10">
            <button id="sendOtp" class="btn btn-primary whitespace-nowrap" type="button" data-i18n="sendOtp">Send OTP</button>
          </div>
          <div id="otpHint" class="mt-1 text-xs text-slate-500"></div>
        </label>

        <label class="text-sm" data-i18n="enterOtp">Enter OTP
          <div class="mt-1 flex gap-2">
            <input id="otpInput" type="number" class="field w-full" placeholder="******" maxlength="6">
            <button id="verifyOtp" class="btn border border-emerald-600 text-emerald-700" type="button" data-i18n="verify">Verify</button>
          </div>
          <div id="otpStatus" class="mt-1 text-xs"></div>
        </label>

        <label class="text-sm" data-i18n="address">Address *
          <div class="mt-1 flex gap-2">
            <input id="custAddress" class="field w-full" placeholder="Village, Mandal, District">
            <button id="locBtn" class="btn border" data-i18n="useLoc">Use current location</button>
          </div>
        </label>
      </div>

      <!-- Final -->
      <div class="p-3 rounded-xl bg-emerald-50 dark:bg-emerald-900/20 flex justify-between">
        <div>üßÆ <span data-i18n="grand">Grand Total</span>: <b id="sGrand">‚Çπ 0</b></div>
        <button id="finalBook" class="btn btn-primary" disabled data-i18n="finalize">Finalize Booking</button>
      </div>
      <p class="text-xs text-slate-500"><span class="badge bg-amber-100 text-amber-700">Note</span> <span data-i18n="note">Booking requires verified mobile & address.</span></p>
    </div>
  </main>

  <script>
    // Language dict
    const dict={
      en:{title:"Seeds ‚Ä¢ Aquaculture A‚ÄìZ",heading:"Seed Booking",state:"State",district:"District",village:"Village",hatchery:"Hatchery",nextProd:"Next Production",nextBatch:"Next Batch",salinity:"Salinity",price:"Price",ehp:"EHP Result",book:"Book",date:"Booking Date",production:"Production",qty:"Quantity (pcs)",bonus:"Bonus",totalSeeds:"Total Seeds",amount:"Amount",mobile:"Customer Mobile *",sendOtp:"Send OTP",enterOtp:"Enter OTP",verify:"Verify",address:"Address *",useLoc:"Use current location",grand:"Grand Total",finalize:"Finalize Booking",note:"Booking requires verified mobile & address."},
      te:{title:"‡∞∏‡±Ä‡∞°‡±ç‡∞∏‡±ç ‚Ä¢ ‡∞Ü‡∞ï‡±ç‡∞µ‡∞æ‡∞ï‡∞≤‡±ç‡∞ö‡∞∞‡±ç A‚ÄìZ",heading:"‡∞∏‡±Ä‡∞°‡±ç ‡∞¨‡±Å‡∞ï‡∞ø‡∞Ç‡∞ó‡±ç",state:"‡∞∞‡∞æ‡∞∑‡±ç‡∞ü‡±ç‡∞∞‡∞Ç",district:"‡∞ú‡∞ø‡∞≤‡±ç‡∞≤‡∞æ",village:"‡∞ó‡±ç‡∞∞‡∞æ‡∞Æ‡∞Ç",hatchery:"‡∞π‡±ç‡∞Ø‡∞æ‡∞ö‡∞∞‡±Ä",nextProd:"‡∞§‡∞¶‡±Å‡∞™‡∞∞‡∞ø ‡∞â‡∞§‡±ç‡∞™‡∞§‡±ç‡∞§‡∞ø",nextBatch:"‡∞§‡∞¶‡±Å‡∞™‡∞∞‡∞ø ‡∞¨‡±ç‡∞Ø‡∞æ‡∞ö‡±ç",salinity:"‡∞â‡∞™‡±ç‡∞™‡±Å‡∞¶‡∞®‡∞Ç",price:"‡∞ß‡∞∞",ehp:"EHP ‡∞´‡∞≤‡∞ø‡∞§‡∞Ç",book:"‡∞¨‡±Å‡∞ï‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø",date:"‡∞¨‡±Å‡∞ï‡∞ø‡∞Ç‡∞ó‡±ç ‡∞§‡±á‡∞¶‡±Ä",production:"‡∞â‡∞§‡±ç‡∞™‡∞§‡±ç‡∞§‡∞ø",qty:"‡∞™‡∞∞‡∞ø‡∞Æ‡∞æ‡∞£‡∞Ç (pcs)",bonus:"‡∞¨‡±ã‡∞®‡∞∏‡±ç",totalSeeds:"‡∞Æ‡±ä‡∞§‡±ç‡∞§‡∞Ç ‡∞∏‡±Ä‡∞°‡±ç‡∞∏‡±ç",amount:"‡∞Æ‡±ä‡∞§‡±ç‡∞§‡∞Ç",mobile:"‡∞ï‡∞∏‡±ç‡∞ü‡∞Æ‡∞∞‡±ç ‡∞Æ‡±ä‡∞¨‡±à‡∞≤‡±ç *",sendOtp:"OTP ‡∞™‡∞Ç‡∞™‡±Å",enterOtp:"OTP ‡∞®‡∞Æ‡±ã‡∞¶‡±Å ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø",verify:"‡∞ß‡±É‡∞µ‡±Ä‡∞ï‡∞∞‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø",address:"‡∞ö‡∞ø‡∞∞‡±Å‡∞®‡∞æ‡∞Æ‡∞æ *",useLoc:"‡∞™‡±ç‡∞∞‡∞∏‡±ç‡∞§‡±Å‡∞§ ‡∞∏‡±ç‡∞•‡∞æ‡∞®‡∞Ç ‡∞µ‡∞æ‡∞°‡∞Ç‡∞°‡∞ø",grand:"‡∞Æ‡±ä‡∞§‡±ç‡∞§‡∞Ç ‡∞Æ‡±ä‡∞§‡±ç‡∞§‡∞Ç",finalize:"‡∞´‡±à‡∞®‡∞≤‡±à‡∞ú‡±ç ‡∞¨‡±Å‡∞ï‡∞ø‡∞Ç‡∞ó‡±ç",note:"‡∞¨‡±Å‡∞ï‡∞ø‡∞Ç‡∞ó‡±ç‚Äå‡∞ï‡∞ø ‡∞ß‡±É‡∞µ‡±Ä‡∞ï‡∞∞‡∞ø‡∞Ç‡∞ö‡∞ø‡∞® ‡∞Æ‡±ä‡∞¨‡±à‡∞≤‡±ç & ‡∞ö‡∞ø‡∞∞‡±Å‡∞®‡∞æ‡∞Æ‡∞æ ‡∞Ö‡∞µ‡∞∏‡∞∞‡∞Ç."}
    };

    function applyI18n(){
      const lang=localStorage.getItem('lang')||'en';
      document.documentElement.lang=lang;
      document.querySelectorAll("[data-i18n]").forEach(el=>{
        const key=el.getAttribute("data-i18n");
        if(dict[lang][key]) el.textContent=dict[lang][key];
      });
      document.title=dict[lang].title;
    }

    // Theme + Lang toggle
    (function(){
      const saved=localStorage.getItem('theme');
      if(saved==='dark'||(!saved&&matchMedia('(prefers-color-scheme: dark)').matches)){
        document.documentElement.classList.add('dark');
      }
      document.getElementById('themeToggle').onclick=()=>{
        document.documentElement.classList.toggle('dark');
        localStorage.setItem('theme',document.documentElement.classList.contains('dark')?'dark':'light');
      };
      document.getElementById('langTE').onclick=()=>{localStorage.setItem('lang','te');applyI18n();};
      document.getElementById('langEN').onclick=()=>{localStorage.setItem('lang','en');applyI18n();};
    })();

    applyI18n();

    // --- Your existing booking logic below (unchanged) ---
    let hatcheries=[],currentOTP=null,otpOk=false,resendTimer=null,left=0;
    async function loadCSV(path){
      const res=await fetch(path);
      const txt=await res.text();
      return txt.trim().split('\n').slice(1).map(r=>{
        const [id,state,district,village,hatchery,salinity,price,bonus,next_production,next_batch,ehp]=r.split(',');
        return {state,district,village,hatchery,salinity,price:+price,bonus:+bonus,next_production,next_batch,ehp_result:ehp};
      });
    }
    async function init(){
      hatcheries=await loadCSV('data/hatcheries.csv');
      const states=[...new Set(hatcheries.map(h=>h.state))];
      sState.innerHTML='<option value="">Select</option>'+states.map(s=>`<option>${s}</option>`).join('');
      sState.onchange=fillDistrict; sDistrict.onchange=fillVillage; sVillage.onchange=fillHatch; sHatchery.onchange=showDetails;
      sQty.addEventListener('input',updateTotals);
    }
    function fillDistrict(){const st=sState.value;if(!st){resetDropdowns(['sDistrict','sVillage','sHatchery']);return;}
      const ds=[...new Set(hatcheries.filter(h=>h.state===st).map(h=>h.district))];
      sDistrict.innerHTML='<option value="">Select</option>'+ds.map(d=>`<option>${d}</option>`).join('');
      resetDropdowns(['sVillage','sHatchery']);}
    function fillVillage(){const st=sState.value,d=sDistrict.value;if(!d){resetDropdowns(['sVillage','sHatchery']);return;}
      const vs=[...new Set(hatcheries.filter(h=>h.state===st&&h.district===d).map(h=>h.village))];
      sVillage.innerHTML='<option value="">Select</option>'+vs.map(v=>`<option>${v}</option>`).join('');
      resetDropdowns(['sHatchery']);}
    function fillHatch(){const st=sState.value,d=sDistrict.value,v=sVillage.value;if(!v){resetDropdowns(['sHatchery']);return;}
      const hs=hatcheries.filter(h=>h.state===st&&h.district===d&&h.village===v);
      sHatchery.innerHTML='<option value="">Select</option>'+hs.map(h=>`<option>${h.hatchery}</option>`).join('');}
    function showDetails(){const st=sState.value,d=sDistrict.value,v=sVillage.value,h=sHatchery.value;
      const x=hatcheries.find(x=>x.state===st&&x.district===d&&x.village===v&&x.hatchery===h);if(!x)return;
      hatchDetails.classList.remove('hidden');
      hName.textContent=x.hatchery; hLoc.textContent=`${x.district}, ${x.village}`;
      hProd.textContent=x.next_production; hBatch.textContent=x.next_batch;hSalinity.textContent=x.salinity;
      hPrice.textContent="‚Çπ "+x.price;hEhp.textContent=x.ehp_result;hBonus.textContent=`Bonus ‚Äî ${x.bonus}%`;
      sPrice.value=x.price;sBatch.value=x.next_batch;sBonus.textContent=`${x.bonus}%`;
      bookBtn.onclick=()=>{bookingForm.classList.remove('hidden');updateTotals();};}
    function updateTotals(){const qty=+sQty.value||0,price=+sPrice.value||0,bonus=parseInt(sBonus.textContent)||0;
      const total=qty+Math.floor(qty*bonus/100);const amt=qty*price;
      sTotal.textContent=total.toLocaleString('en-IN');sAmount.textContent="‚Çπ "+amt.toLocaleString('en-IN');sGrand.textContent="‚Çπ "+amt.toLocaleString('en-IN');validateForm();}
    function resetDropdowns(ids){ids.forEach(id=>document.getElementById(id).innerHTML='<option value="">Select</option>');
      hatchDetails.classList.add('hidden');bookingForm.classList.add('hidden');}
    const validMobile=n=>/^[6-9]\d{9}$/.test(n||'');
    sendOtp.onclick=()=>{if(!validMobile(custMobile.value)){otpHint.textContent="‚ùå Invalid mobile";return;}
      currentOTP=(''+Math.floor(100000+Math.random()*900000));otpOk=false;otpInput.value='';otpStatus.textContent='';
      otpHint.innerHTML="OTP (demo): <b>"+currentOTP+"</b>";
      left=30;sendOtp.disabled=true;sendOtp.textContent=`${left}s`;resendTimer&&clearInterval(resendTimer);
      resendTimer=setInterval(()=>{left--;sendOtp.textContent=`${left}s`;if(left<=0){clearInterval(resendTimer);sendOtp.disabled=false;sendOtp.textContent="Resend OTP";}},1000);validateForm();};
    verifyOtp.onclick=()=>{if(otpInput.value===currentOTP&&currentOTP){otpOk=true;otpStatus.textContent="‚úî Verified";otpStatus.className='text-xs text-emerald-600';}
      else{otpOk=false;otpStatus.textContent="‚ùå Wrong OTP";otpStatus.className='text-xs text-rose-600';}validateForm();};
    locBtn.onclick=(e)=>{e.preventDefault();navigator.geolocation?.getCurrentPosition(pos=>{custAddress.value=`Lat:${pos.coords.latitude.toFixed(4)}, Lng:${pos.coords.longitude.toFixed(4)}`;validateForm();});};
    function validateForm(){const okMobile=validMobile(custMobile.value)&&otpOk,okAddr=(custAddress.value||'').trim().length>0;finalBook.disabled=!(okMobile&&okAddr);}
    custMobile.oninput=()=>{otpOk=false;otpStatus.textContent='';validateForm();};
    custAddress.oninput=validateForm;
    finalBook.onclick=()=>{if(finalBook.disabled)return;alert("‚úÖ Seeds booking confirmed!");};
    init();
  </script>
</body>
</html>
