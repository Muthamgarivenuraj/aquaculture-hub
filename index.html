<!DOCTYPE html>
<html lang="te">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Aquaculture A–Z Hub • Dashboard (Color + Logo)</title>
  <meta name="description" content="Colorful dashboard for prawns: live rates, harvesting, seeds, vendors, technicians, knowledge, and posts. Telugu/English support."/>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: { brand: { 50:'#ecfdf5', 100:'#d1fae5', 500:'#10b981', 600:'#059669', 700:'#047857' } },
          boxShadow: { soft: '0 12px 30px rgba(2,6,23,.08)' }
        }
      }
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
  <style>
    html{scroll-behavior:smooth}
    /* Background gradient via CSS variables */
    :root{--bg1:#f0f9ff;--bg2:#ecfdf5;--bg3:#fefce8}
    body{background: linear-gradient(135deg,var(--bg1) 0%,var(--bg2) 50%,var(--bg3) 100%);} 
    .dark body{background: linear-gradient(135deg,#0f172a 0%,#082f49 50%,#14532d 100%);} 
  </style>
</head>
<body class="text-slate-900 dark:text-slate-100">
  <!-- Top Bar -->
  <header class="sticky top-0 z-30 backdrop-blur bg-white/80 dark:bg-slate-950/70 border-b border-slate-200/60 dark:border-slate-800">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center gap-3">
      <!-- Logo -->
      <div class="h-10 w-10 rounded-2xl overflow-hidden shadow-soft">
        <!-- Inline SVG logo for crisp rendering -->
        <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" class="h-full w-full">
          <defs>
            <linearGradient id="g1" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#60a5fa"/>
              <stop offset="100%" stop-color="#34d399"/>
            </linearGradient>
          </defs>
          <rect rx="16" ry="16" width="64" height="64" fill="url(#g1)" />
          <g fill="#ffffff" opacity="0.95">
            <!-- stylized shrimp -->
            <path d="M46 20c-6-2-13 1-17 6-4 5-5 12-1 16 4 4 10 3 14-1 3-3 4-7 3-11-4 1-8 0-11-2 4-1 8-2 12-8z"/>
            <circle cx="42" cy="24" r="2"/>
            <!-- waves -->
            <path d="M12 42c5 3 10 3 15 0 5-3 10-3 15 0" fill="none" stroke="#ffffff" stroke-width="2.5" stroke-linecap="round"/>
            <path d="M12 48c5 3 10 3 15 0 5-3 10-3 15 0" fill="none" stroke="#ffffff" stroke-width="2.5" stroke-linecap="round"/>
          </g>
        </svg>
      </div>
      <div>
        <h1 class="text-xl font-bold leading-tight">Aquaculture A–Z Hub</h1>
        <p class="text-xs text-slate-500" id="subtitle">Andhra Pradesh</p>
      </div>
      <div class="ml-auto flex items-center gap-2">
        <!-- BG theme presets -->
        <div class="hidden md:flex items-center gap-1 rounded-full bg-slate-100 dark:bg-slate-900 p-1 border border-slate-200 dark:border-slate-800">
          <button data-bg="mint" class="px-2 py-1 text-xs rounded-full bg-white dark:bg-slate-800">Mint</button>
          <button data-bg="ocean" class="px-2 py-1 text-xs rounded-full">Ocean</button>
          <button data-bg="sunrise" class="px-2 py-1 text-xs rounded-full">Sunrise</button>
        </div>
        <!-- Lang Switch -->
        <div class="flex rounded-full bg-slate-100 dark:bg-slate-900 p-1 border border-slate-200 dark:border-slate-800">
          <button id="langEN" class="px-3 py-1.5 text-sm rounded-full bg-white dark:bg-slate-800 shadow-soft">English</button>
          <button id="langTE" class="px-3 py-1.5 text-sm rounded-full">తెలుగు</button>
        </div>
        <button id="themeToggle" class="rounded-full px-3 py-1.5 text-sm border border-slate-200 dark:border-slate-800">🌙/☀️</button>
      </div>
    </div>
  </header>

  <main class="max-w-7xl mx-auto p-4 space-y-6">
    <!-- Location + Search -->
    <section class="rounded-3xl bg-gradient-to-r from-sky-50 to-emerald-50 dark:from-slate-900 dark:to-slate-800 p-4 md:p-5 shadow-soft border border-slate-100 dark:border-slate-800">
      <div class="flex flex-col md:flex-row md:items-center gap-3">
        <div class="flex items-center gap-2 w-full md:w-auto">
          <label class="text-sm text-slate-500" data-i18n="district">District</label>
          <select id="district" class="w-full md:w-64 rounded-xl bg-white dark:bg-slate-950 border border-slate-200 dark:border-slate-800 px-3 py-2 text-sm">
            <option>Nellore</option>
            <option>Prakasam</option>
            <option>Krishna</option>
            <option>East Godavari</option>
            <option>West Godavari</option>
            <option>Guntur</option>
          </select>
        </div>
        <div class="flex items-center gap-2 w-full md:w-auto md:ml-auto">
          <div class="flex items-center rounded-full bg-slate-100 dark:bg-slate-900 px-3 py-2 w-full md:w-80">
            <input id="q" class="bg-transparent outline-none text-sm w-full" placeholder="Search rates, seeds, vendors…" />
          </div>
          <a id="whTop" target="_blank" class="rounded-xl px-4 py-2 bg-emerald-600 text-white text-sm shadow-soft">WhatsApp</a>
        </div>
      </div>
    </section>

    <!-- Feature Grid -->
    <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      <a href="live-rates.html#prices" class="group rounded-3xl p-5 bg-gradient-to-tr from-sky-100 to-white dark:from-slate-800 dark:to-slate-900 shadow-soft border border-slate-100 dark:border-slate-800 hover:-translate-y-0.5 transition">
        <div class="text-2xl">📈</div>
        <h3 class="mt-2 text-lg font-semibold" data-i18n="live_rates">Live Rates</h3>
        <p class="text-slate-500 text-sm" data-i18n="live_rates_sub">Shrimp, feed, diesel & ice</p>
      </a>
      <a href="live-rates.html#vendors" class="group rounded-3xl p-5 bg-gradient-to-tr from-emerald-100 to-white dark:from-slate-800 dark:to-slate-900 shadow-soft border border-slate-100 dark:border-slate-800">
        <div class="text-2xl">🏪</div>
        <h3 class="mt-2 text-lg font-semibold" data-i18n="vendors">Vendors</h3>
        <p class="text-slate-500 text-sm" data-i18n="vendors_sub">Feeds · Seeds · Medicines · Labs</p>
      </a>
      <a href="live-rates.html#tech" class="group rounded-3xl p-5 bg-gradient-to-tr from-fuchsia-100 to-white dark:from-slate-800 dark:to-slate-900 shadow-soft border border-slate-100 dark:border-slate-800">
        <div class="text-2xl">🧪</div>
        <h3 class="mt-2 text-lg font-semibold" data-i18n="tech">Technicians & Labs</h3>
        <p class="text-slate-500 text-sm" data-i18n="tech_sub">Directory & contact</p>
      </a>
      <a href="live-rates.html#knowledge" class="group rounded-3xl p-5 bg-gradient-to-tr from-amber-100 to-white dark:from-slate-800 dark:to-slate-900 shadow-soft border border-slate-100 dark:border-slate-800">
        <div class="text-2xl">📚</div>
        <h3 class="mt-2 text-lg font-semibold" data-i18n="kc">Knowledge Center</h3>
        <p class="text-slate-500 text-sm" data-i18n="kc_sub">Prawn culture A–Z</p>
      </a>
      <a href="live-rates.html#news" class="group rounded-3xl p-5 bg-gradient-to-tr from-rose-100 to-white dark:from-slate-800 dark:to-slate-900 shadow-soft border border-slate-100 dark:border-slate-800">
        <div class="text-2xl">📰</div>
        <h3 class="mt-2 text-lg font-semibold" data-i18n="news">News & Schemes</h3>
        <p class="text-slate-500 text-sm" data-i18n="news_sub">Updates & subsidies</p>
      </a>
      <a href="live-rates.html#post" class="group rounded-3xl p-5 bg-gradient-to-tr from-cyan-100 to-white dark:from-slate-800 dark:to-slate-900 shadow-soft border border-slate-100 dark:border-slate-800">
        <div class="text-2xl">📨</div>
        <h3 class="mt-2 text-lg font-semibold" data-i18n="post">Post a Requirement</h3>
        <p class="text-slate-500 text-sm" data-i18n="post_sub">Get dealer callbacks</p>
      </a>
    </section>

    <!-- Today Snapshot -->
    <section class="rounded-3xl p-5 bg-gradient-to-tr from-white via-sky-50 to-emerald-50 dark:from-slate-900 dark:via-slate-950 dark:to-slate-800 shadow-soft border border-slate-100 dark:border-slate-800">
      <div class="flex items-center justify-between flex-wrap gap-3">
        <h2 class="font-semibold" data-i18n="today_rates">Today Snapshot</h2>
        <p class="text-xs text-slate-500"><span data-i18n="updated">Updated</span>: <span id="updatedAt">—</span></p>
      </div>
      <div class="mt-4 grid grid-cols-2 md:grid-cols-4 gap-3">
        <div class="rounded-2xl p-4 bg-gradient-to-br from-emerald-50 to-white dark:from-emerald-900/30 dark:to-slate-900 border border-emerald-200/70 dark:border-emerald-900/40">
          <p class="text-xs text-emerald-700 dark:text-emerald-200" data-i18n="avg">Avg (₹/kg)</p>
          <h4 id="avg" class="text-xl font-bold">—</h4>
        </div>
        <div class="rounded-2xl p-4 bg-gradient-to-br from-sky-50 to-white dark:from-sky-900/30 dark:to-slate-900 border border-sky-200/70 dark:border-sky-900/40">
          <p class="text-xs text-sky-700 dark:text-sky-200" data-i18n="best">Best</p>
          <h4 id="best" class="text-xl font-bold">—</h4>
        </div>
        <div class="rounded-2xl p-4 bg-gradient-to-br from-rose-50 to-white dark:from-rose-900/30 dark:to-slate-900 border border-rose-200/70 dark:border-rose-900/40">
          <p class="text-xs text-rose-700 dark:text-rose-200" data-i18n="low">Lowest</p>
          <h4 id="low" class="text-xl font-bold">—</h4>
        </div>
        <div class="rounded-2xl p-4 bg-gradient-to-br from-amber-50 to-white dark:from-amber-900/30 dark:to-slate-900 border border-amber-200/70 dark:border-amber-900/40">
          <p class="text-xs text-amber-700 dark:text-amber-200" data-i18n="spread">30c–50c Spread</p>
          <h4 id="spread" class="text-xl font-bold">—</h4>
        </div>
      </div>
      <canvas id="spark" class="mt-4 h-36"></canvas>
      <a href="live-rates.html#prices" class="mt-4 inline-flex items-center rounded-xl px-4 py-2 bg-emerald-600 text-white shadow-soft">Open full rates →</a>
    </section>

    <footer class="py-6 text-center text-sm text-slate-600">© <span id="year"></span> Aquaculture A–Z Hub • AP‑first</footer>
  </main>

  <script>
    // i18n
    const dict = { 
      en:{district:'District', live_rates:'Live Rates', live_rates_sub:'Shrimp, feed, diesel & ice', vendors:'Vendors', vendors_sub:'Feeds · Seeds · Medicines · Labs', tech:'Technicians & Labs', tech_sub:'Directory & contact', kc:'Knowledge Center', kc_sub:'Prawn culture A–Z', news:'News & Schemes', news_sub:'Updates & subsidies', post:'Post a Requirement', post_sub:'Get dealer callbacks', today_rates:'Today Snapshot', updated:'Updated', avg:'Avg (₹/kg)', best:'Best', low:'Lowest', spread:'30c–50c Spread'}, 
      te:{district:'జిల్లా', live_rates:'లైవ్ రేట్స్', live_rates_sub:'చేపలు, ఫీడ్, డీజల్ & ఐస్', vendors:'వెండర్ల జాబితా', vendors_sub:'ఫీడ్స్ · సీడ్స్ · మెడిసిన్స్ · ల్యాబ్స్', tech:'టెక్నీషియన్స్ & ల్యాబ్స్', tech_sub:'డైరెక్టరీ & కాంటాక్ట్', kc:'నాలెడ్జ్ సెంటర్', kc_sub:'ప్రాన్స్ కల్చర్ A–Z', news:'న్యూస్ & స్కీమ్స్', news_sub:'అప్డేట్స్ & సబ్సిడీస్', post:'రక్వైర్మెంట్ పోస్ట్', post_sub:'డీలర్ల కాల్‌బ్యాక్‌లు', today_rates:'ఈరోజు స్నాప్‌షాట్', updated:'అప్‌డేట్', avg:'సగటు (₹/kg)', best:'అత్యధిక', low:'కనిష్ట', spread:'30c–50c వ్యత్యాసం'} 
    };
    let lang='en';
    function applyI18n(){
      document.querySelectorAll('[data-i18n]').forEach(el=>{const k=el.getAttribute('data-i18n');el.textContent=dict[lang][k]||el.textContent});
      document.getElementById('q').placeholder=lang==='en'? 'Search rates, seeds, vendors…' : 'రేట్స్, సీడ్స్, వెండర్ల కోసం సెర్చ్…';
      document.getElementById('subtitle').textContent=lang==='en'? 'Andhra Pradesh':'ఆంధ్ర ప్రదేశ్';
    }
    document.getElementById('langEN').addEventListener('click',()=>{lang='en';applyI18n();});
    document.getElementById('langTE').addEventListener('click',()=>{lang='te';applyI18n();});

    // Theme toggle
    const themeToggle=document.getElementById('themeToggle');
    const saved=localStorage.getItem('theme');
    if(saved==='dark'||(!saved&&matchMedia('(prefers-color-scheme: dark)').matches)) document.documentElement.classList.add('dark');
    themeToggle.addEventListener('click',()=>{document.documentElement.classList.toggle('dark');localStorage.setItem('theme',document.documentElement.classList.contains('dark')?'dark':'light');});

    // WhatsApp CTA
    function initWA(){
      const num='919999999999'; // TODO replace
      const text='Hi, need help with rates/harvesting/seeds.';
      const link=`https://wa.me/${num}?text=${encodeURIComponent(text)}`;
      document.getElementById('whTop').href=link;
    }

    // Background theme presets
    const themes={
      mint:{bg1:'#f0f9ff',bg2:'#ecfdf5',bg3:'#fefce8'},
      ocean:{bg1:'#e0f2fe',bg2:'#e0f7fa',bg3:'#e0f2fe'},
      sunrise:{bg1:'#fff7ed',bg2:'#fffbeb',bg3:'#ecfeff'}
    };
    function applyBg(name){
      const t=themes[name]||themes.mint;
      document.documentElement.style.setProperty('--bg1',t.bg1);
      document.documentElement.style.setProperty('--bg2',t.bg2);
      document.documentElement.style.setProperty('--bg3',t.bg3);
      localStorage.setItem('bgTheme',name);
    }
    document.querySelectorAll('[data-bg]').forEach(btn=>btn.addEventListener('click',()=>applyBg(btn.dataset.bg)));

    // CSV → KPIs + sparkline
    async function loadRates(){
      try{
        const res=await fetch('rates.csv',{cache:'no-store'});
        const csv=await res.text();
        const rows=csv.trim().split(/
?
/).map(r=>r.split(','));
        const h=rows[0].map(x=>x.trim().toLowerCase());
        const iC=h.indexOf('count'), iP=h.indexOf('price');
        const data=rows.slice(1).map(r=>({count:parseInt(r[iC]),price:parseFloat(r[iP])})).filter(x=>!isNaN(x.price));
        if(!data.length) return;
        const avg=data.reduce((s,x)=>s+x.price,0)/data.length;
        const best=Math.max(...data.map(x=>x.price));
        const low=Math.min(...data.map(x=>x.price));
        const c30=data.find(x=>x.count===30);
        const c50=data.find(x=>x.count===50);
        const spread=(c30&&c50)?(c30.price-c50.price):null;
        document.getElementById('avg').textContent=`₹ ${avg.toFixed(0)}`;
        document.getElementById('best').textContent=`₹ ${best.toFixed(0)}`;
        document.getElementById('low').textContent=`₹ ${low.toFixed(0)}`;
        document.getElementById('spread').textContent=spread==null?'—':`${spread>0?'▲':'▼'} ₹ ${Math.abs(spread).toFixed(0)}`;
        document.getElementById('updatedAt').textContent=new Intl.DateTimeFormat('en-IN',{dateStyle:'medium',timeStyle:'short'}).format(new Date());
        const ordered=data.sort((a,b)=>b.count-a.count);
        new Chart(document.getElementById('spark'),{
          type:'line',
          data:{labels:ordered.map(x=>x.count+'c'),datasets:[{label:'₹/kg',data:ordered.map(x=>x.price),tension:.35,fill:false}]},
          options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{x:{display:false},y:{display:false}}}
        });
      }catch(e){console.error('rates.csv failed', e)}
    }

    // Init
    document.getElementById('year').textContent = new Date().getFullYear();
    applyI18n();
    initWA();
    applyBg(localStorage.getItem('bgTheme')||'mint');
    loadRates();
  </script>
</body>
</html>
