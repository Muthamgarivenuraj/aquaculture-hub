<!DOCTYPE html>
<html lang="te">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Aquaculture A–Z • Home</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config={darkMode:'class',theme:{extend:{boxShadow:{soft:'0 12px 28px rgba(2,6,23,.08)'}}}}
  </script>
  <style>
    html{scroll-behavior:smooth}
    body{background:linear-gradient(135deg,#dbeafe 0%,#e0f2fe 50%,#f0fdf4 100%)}
    .dark body{background:linear-gradient(135deg,#0f172a 0%,#082f49 50%,#14532d 100%)}
    .navbtn{border:1px solid rgb(226,232,240);padding:.55rem .9rem;border-radius:.75rem;background:#fff;text-align:center;font-weight:700;font-size:1rem;white-space:nowrap;}
    @media (min-width:640px){ .navbtn{font-size:.95rem;padding:.6rem 1rem} }
    .dark .navbtn{background:#0b1220;border-color:#1f2937}
    .ticker{overflow:hidden;mask-image:linear-gradient(90deg,transparent,black 8%,black 92%,transparent);-webkit-mask-image:linear-gradient(90deg,transparent,black 8%,black 92%,transparent)}
    .ticker-track{display:flex;gap:24px;white-space:nowrap;min-width:max-content;animation:ticker 20s linear infinite}
    @keyframes ticker{from{transform:translateX(0)} to{transform:translateX(-50%)}}
    @media (max-width:640px){.ticker{mask-image:none;-webkit-mask-image:none}.ticker-track{gap:16px;animation-duration:28s}}
    @keyframes blink{0%,100%{opacity:1;background-color:#facc15;color:#111827}50%{opacity:1;background-color:#dc2626;color:#fff}}
    .blink{animation:blink 1.2s infinite}
    .promo-dot{height:.5rem;width:.5rem;border-radius:9999px;border:1px solid currentColor;opacity:.5}
    .promo-dot.active{opacity:1;background:currentColor}
    .promo-slide{display:none}
    .promo-slide.active{display:block}
  </style>
</head>
<body class="text-slate-900 dark:text-slate-100">
  <!-- Header -->
  <header class="sticky top-0 z-30 backdrop-blur bg-white/80 dark:bg-slate-950/70 border-b border-slate-200 dark:border-slate-800">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center">
      <div class="h-9 w-9 mr-1 relative">
        <img src="assets/logo.png" alt="Logo" class="h-9 w-9 object-contain block dark:hidden">
        <img src="assets/logo-dark.png" alt="Logo" class="h-9 w-9 object-contain hidden dark:block">
      </div>
      <h1 class="text-xl font-bold hidden sm:inline">Aquaculture A–Z</h1>
      <h1 class="text-xl font-bold sm:hidden mr-14 sm:mr-0">Aquaa A–Z</h1>
      <nav class="hidden sm:flex gap-2 flex-1 justify-center">
        <a href="index.html" class="navbtn">🏠 <span data-i18n="m_home">Home</span></a>
        <a href="harvest.html" class="navbtn">🚚 <span data-i18n="t_harvest">Harvest</span></a>
        <a href="seeds.html" class="navbtn">🦐 <span data-i18n="t_seeds">Seeds</span></a>
        <a href="vendors.html" class="navbtn">🏪 <span data-i18n="t_dealers">Dealers</span></a>
        <a href="seeds.html" class="navbtn">🦐 <span data-i18n="m_shrimp">Shrimp</span></a>
        <a href="contact.html" class="navbtn">📞 <span data-i18n="contact">Contact</span></a>
      </nav>
      <div class="flex items-center gap-2 flex-none">
        <label for="langSel" class="text-sm text-slate-600 dark:text-slate-300 select-none">Ln</label>
        <select id="langSel" class="text-sm border rounded-md px-2 py-1 dark:bg-slate-900 dark:border-slate-700">
          <option value="te">తెలుగు</option>
          <option value="en">English</option>
        </select>
        <button id="themeToggle" class="rounded-full px-3 py-1.5 text-sm border border-slate-200 dark:border-slate-800">🌙/☀️</button>
      </div>
    </div>
  </header>

  <main class="max-w-7xl mx-auto p-3 sm:p-4 space-y-4 pb-24 sm:pb-4">
    <!-- MOBILE nav buttons -->
    <div class="flex sm:hidden gap-2 justify-around">
      <a href="harvest.html" class="navbtn flex-1 text-center">🚚 <span data-i18n="t_harvest">Harvest</span></a>
      <a href="seeds.html" class="navbtn flex-1 text-center">🦐 <span data-i18n="t_seeds">Seeds</span></a>
      <a href="vendors.html" class="navbtn flex-1 text-center">🏪 <span data-i18n="t_dealers">Dealers</span></a>
    </div>

    <!-- Flash News -->
    <section class="rounded-2xl p-4 bg-white dark:bg-slate-900 shadow-soft border border-slate-200/60 dark:border-slate-800">
      <div class="flex items-center justify-between">
        <h3 class="font-semibold">📰 <span data-i18n="flash_news">Flash News</span></h3>
        <span class="text-xs px-2 py-1 rounded-full bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-200">Live</span>
      </div>
      <div class="mt-3 ticker"><div id="newsTrackTop" class="ticker-track"></div></div>
      <p class="text-xs text-slate-500 mt-2"><span data-i18n="updated">Updated</span>: <span id="newsUpdatedTop">—</span></p>
    </section>

    <!-- Rates + Promotions -->
    <section class="grid grid-cols-1 lg:grid-cols-2 gap-4">
      <!-- Rates -->
      <div class="rounded-2xl p-4 bg-white dark:bg-slate-900 shadow-soft border border-slate-200/60 dark:border-slate-800">
        <div class="flex items-center justify-between">
          <h3 class="font-semibold" data-i18n="snapshot">లైవ్ స్నాప్‌షాట్</h3>
          <p class="text-xs text-slate-500"><span data-i18n="updated">అప్‌డేట్</span>: <span id="updatedAt">—</span></p>
        </div>
        <div class="mt-3 flex items-center gap-3">
          <label for="prawnType" class="text-sm font-medium" data-i18n="lbl_type">రకం</label>
          <select id="prawnType" class="text-sm border rounded-md px-2 py-1 dark:bg-slate-800 dark:border-slate-600"></select>
        </div>
        <div class="mt-3 overflow-x-auto">
          <table class="min-w-full text-sm" id="ratesTable">
            <thead>
              <tr class="border-b dark:border-slate-800 text-slate-500">
                <th class="text-left py-2 pr-4" data-i18n="th_count">కౌంట్</th>
                <th class="text-left py-2 pr-4" data-i18n="th_price">ధర (₹/kg)</th>
                <th class="text-left py-2 pr-4" data-i18n="th_change">మార్పు</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <!-- Promotions -->
      <div class="rounded-2xl p-4 bg-white dark:bg-slate-900 shadow-soft border border-slate-200/60 dark:border-slate-800">
        <div class="flex items-center justify-between">
          <h3 class="font-semibold">📣 <span data-i18n="promotions_title">ప్రోమోషన్స్</span></h3>
        </div>
        <div id="promoSlider" class="relative mt-3">
          <div id="promoTrack" class="overflow-hidden rounded-xl"></div>
          <div id="promoDots" class="mt-3 flex gap-2"></div>
        </div>
      </div>
    </section>
  </main>

  <!-- Bottom nav -->
  <nav class="fixed bottom-0 inset-x-0 bg-white dark:bg-slate-900 border-t border-slate-200 dark:border-slate-700 flex justify-around py-2 z-40 sm:hidden"
       style="padding-bottom: env(safe-area-inset-bottom);">
    <a href="index.html" class="flex flex-col items-center text-base font-semibold">
      <span>🏠</span><span data-i18n="m_home">Home</span>
    </a>
    <a href="harvest.html" class="flex flex-col items-center text-base font-semibold">
      <span>🕘</span><span data-i18n="m_history">History</span>
    </a>
    <a href="seeds.html" class="flex flex-col items-center text-base font-semibold">
      <span>🦐</span><span data-i18n="m_shrimp">Shrimp</span>
    </a>
  </nav>

  <script>
    const $id = s=>document.getElementById(s);

    async function loadCSV(url){
      try{const res=await fetch(url,{cache:'no-store'});if(!res.ok) throw 0;
        const txt=await res.text();const lines=txt.trim().split(/\r?\n/);
        const headers=lines[0].split(',').map(h=>h.trim());
        return lines.slice(1).map(line=>{
          const vals=line.split(',');const o={};headers.forEach((h,i)=>o[h]=vals[i]);return o;
        });
      }catch(e){return [];}
    }

    const dict={
      en:{snapshot:"Live Snapshot",updated:"Updated",lbl_type:"Type",th_count:"Count",th_price:"Price (₹/kg)",th_change:"Change",promotions_title:"Promotions",m_home:"Home",m_history:"History",m_shrimp:"Shrimp",t_harvest:"Harvest",t_seeds:"Seeds",t_dealers:"Dealers",contact:"Contact",flash_news:"Flash News",type_van:"Vannamei",type_tig:"Tiger"},
      te:{snapshot:"లైవ్ స్నాప్‌షాట్",updated:"అప్‌డేట్",lbl_type:"రకం",th_count:"కౌంట్",th_price:"ధర (₹/kg)",th_change:"మార్పు",promotions_title:"ప్రోమోషన్స్",m_home:"హోమ్",m_history:"చరిత్ర",m_shrimp:"రొయ్యలు",t_harvest:"హార్వెస్ట్",t_seeds:"సీడ్స్",t_dealers:"వెండర్లు",contact:"సంప్రదించండి",flash_news:"ఫ్లాష్ న్యూస్",type_van:"వన్నామీ",type_tig:"టైగర్"}
    };

    function applyI18n(){const lang=localStorage.getItem('lang')||'te';document.documentElement.lang=lang;document.querySelectorAll('[data-i18n]').forEach(el=>{const k=el.dataset.i18n;if(dict[lang][k])el.textContent=dict[lang][k];});$id('langSel').value=lang;}

    // ✅ Badge function restored
    function badge(d){
      if(d===null) 
        return `<span class="inline-flex px-2 py-0.5 rounded-full text-xs bg-slate-100 text-slate-600 dark:bg-slate-800 dark:text-slate-300">—</span>`;
      if(d>0) 
        return `<span class="inline-flex gap-1 px-2 py-0.5 rounded-full text-xs bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300">▲ +₹${d}</span>`;
      if(d<0) 
        return `<span class="inline-flex gap-1 px-2 py-0.5 rounded-full text-xs bg-rose-100 text-rose-700 dark:bg-rose-900/30 dark:text-rose-300">▼ ₹${Math.abs(d)}</span>`;
      return `<span class="inline-flex px-2 py-0.5 rounded-full text-xs bg-slate-100 text-slate-600 dark:bg-slate-800 dark:text-slate-300">—</span>`;
    }

    function renderRates(data,type){const body=$id('ratesTable').querySelector('tbody');body.innerHTML='';
      const rows=data.filter(r=>r.type===type);
      rows.forEach(r=>{const diff=(+r.current||0)-(+r.previous||0);
        const tr=document.createElement('tr');tr.className="border-b last:border-0 dark:border-slate-800";
        tr.innerHTML=`<td class="py-2 pr-4 font-medium">${r.count}c</td>
                      <td class="py-2 pr-4">₹ ${r.current}</td>
                      <td class="py-2 pr-4">${badge(diff)}</td>`;
        body.appendChild(tr);
      });
      $id('updatedAt').textContent=new Intl.DateTimeFormat('en-IN',{dateStyle:'medium',timeStyle:'short'}).format(new Date());
    }

    function renderNews(data){
      const lang=localStorage.getItem('lang')||'te';
      const list=data.filter(n=>n.lang===lang);
      const row=list.map(n=>{
        const blink=String(n.tag).toLowerCase().includes('harvest')||String(n.tag).includes('హార్వెస్ట్');
        return `<div class="flex items-center gap-2 pr-4">
                  <span class="px-2 py-0.5 rounded-full text-[11px] ${blink?'blink bg-sky-200':'bg-sky-100'}">${n.tag}</span>
                  <span>${n.text}</span>
                </div>`;
      }).join('');
      $id('newsTrackTop').innerHTML=row+row+row;
      $id('newsUpdatedTop').textContent=new Intl.DateTimeFormat('en-IN',{dateStyle:'medium',timeStyle:'short'}).format(new Date());
    }

    let PROMOS=[],promoIdx=0,timer=null;
    function renderPromo(){const lang=localStorage.getItem('lang')||'te';
      const track=$id('promoTrack'),dots=$id('promoDots');
      track.innerHTML=PROMOS.map((r,i)=>`
        <div class="promo-slide rounded-xl p-4 bg-blue-50 dark:bg-slate-800/40 ${i===promoIdx?'active':''}">
          ${r.badge?`<span class="inline-block text-xs px-3 py-1 rounded-full bg-sky-200/70">${r.badge}</span>`:''}
          <h4 class="mt-3 text-lg font-semibold">${lang==='te'?(r.title_te||r.title_en):(r.title_en||r.title_te)}</h4>
          <p class="text-slate-600 dark:text-slate-300">${lang==='te'?(r.desc_te||r.desc_en):(r.desc_en||r.desc_te)}</p>
        </div>`).join('');
      dots.innerHTML=PROMOS.map((_,i)=>`<button class="promo-dot ${i===promoIdx?'active':''}" data-i="${i}"></button>`).join('');
      dots.querySelectorAll('button').forEach(b=>b.onclick=()=>{promoIdx=+b.dataset.i;renderPromo();startPromo();});
    }
    function startPromo(){if(timer)clearInterval(timer);timer=setInterval(()=>{promoIdx=(promoIdx+1)%PROMOS.length;renderPromo();},6000);}

    document.addEventListener('DOMContentLoaded',async()=>{
      if(!localStorage.getItem('lang'))localStorage.setItem('lang','te');
      applyI18n();

      const saved=localStorage.getItem('theme');if(saved==='dark'||(!saved&&matchMedia('(prefers-color-scheme: dark)').matches))document.documentElement.classList.add('dark');
      $id('themeToggle').onclick=()=>{document.documentElement.classList.toggle('dark');localStorage.setItem('theme',document.documentElement.classList.contains('dark')?'dark':'light');};

      const rates=await loadCSV("data/rates.csv");
      const NEWS=await loadCSV("data/news.csv");
      PROMOS=await loadCSV("data/promotions.csv");

      function fillTypeOptions(){
        const lang=localStorage.getItem('lang')||'te';
        $id('prawnType').innerHTML=`<option value="Vannamei">${dict[lang].type_van}</option>
                                    <option value="Tiger">${dict[lang].type_tig}</option>`;
      }

      fillTypeOptions();
      $id('prawnType').onchange=()=>renderRates(rates,$id('prawnType').value);
      renderRates(rates,"Vannamei");

      renderNews(NEWS);renderPromo();startPromo();

      $id('langSel').onchange=e=>{localStorage.setItem('lang',e.target.value);applyI18n();fillTypeOptions();renderRates(rates,$id('prawnType').value);renderNews(NEWS);renderPromo();};
    });
  </script>
</body>
</html>
